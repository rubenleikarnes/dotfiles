(()=>{"use strict";var e={5747:(e,t,r)=>{var s,o=Object.defineProperty,n=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,c={};((e,t)=>{for(var r in t)o(e,r,{get:t[r],enumerable:!0})})(c,{config:()=>h,t:()=>f}),e.exports=(s=c,((e,t,r,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let r of i(t))a.call(e,r)||undefined===r||o(e,r,{get:()=>t[r],enumerable:!(s=n(t,r))||s.enumerable});return e})(o({},"__esModule",{value:!0}),s));var l,u=r(9896),d=r(1943);function h(e){if("contents"in e)l="string"==typeof e.contents?JSON.parse(e.contents):e.contents;else if("fsPath"in e){const r=(t=e.fsPath,(0,u.readFileSync)(t,"utf8")),s=JSON.parse(r);l=m(s)?s.contents.bundle:s}else{var t;if(e.uri){let t=e.uri;return"string"==typeof e.uri&&(t=new URL(e.uri)),new Promise(((e,r)=>{(async function(e){if("file:"===e.protocol)return await(0,d.readFile)(e,"utf8");if("http:"===e.protocol||"https:"===e.protocol){const t=await fetch(e.toString(),{headers:{"Accept-Encoding":"gzip, deflate",Accept:"application/json"},redirect:"follow"});if(!t.ok){let r=`Unexpected ${t.status} response while trying to read ${e}`;try{r+=`: ${await t.text()}`}catch{}throw new Error(r)}return await t.text()}throw new Error("Unsupported protocol")})(t).then((t=>{try{const r=JSON.parse(t);l=m(r)?r.contents.bundle:r,e()}catch(e){r(e)}})).catch((e=>{r(e)}))}))}}}function f(...e){const t=e[0];let r,s,o;if("string"==typeof t)r=t,s=t,e.splice(0,1),o=e&&"object"==typeof e[0]?e[0]:e;else{if(t instanceof Array){const r=e.slice(1);if(t.length!==r.length+1)throw new Error("expected a string as the first argument to l10n.t");let s=t[0];for(let e=1;e<t.length;e++)s+=`{${e-1}}`+t[e];return f(s,...r)}s=t.message,r=s,t.comment&&t.comment.length>0&&(r+=`/${Array.isArray(t.comment)?t.comment.join(""):t.comment}`),o=t.args??{}}const n=l?.[r];return n?"string"==typeof n?g(n,o):n.comment?g(n.message,o):g(s,o):g(s,o)}var p=/{([^}]+)}/g;function g(e,t){return 0===Object.keys(t).length?e:e.replace(p,((e,r)=>t[r]??e))}function m(e){return!("object"!=typeof e?.contents?.bundle||"string"!=typeof e?.version)}},57:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLogFile=function(e,t){const r=(0,o.join)(e,`${t}-${(new Date).toISOString().replace(/[Z: -\.]/g,"").substr(0,15)}.log`);s.mkdirSync(e,{recursive:!0});const i=s.createWriteStream(r,{flags:"a"});return{location:r,log:(e,...t)=>{const r=`[${(new Date).toISOString().replace(/[TZ]/g," ").trim()}] ${n.format(e,...t)}\n`;i.write(r)},close:()=>new Promise((e=>{i.end(),i.once("finish",(()=>{e()}))}))}},t.nullLogFile=function(){return{location:"",log:()=>{},close:()=>Promise.resolve()}};const s=r(9896),o=r(6928),n=r(9023)},7015:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0,t.getNodeExecServer=function(){return{async exec({env:e,cmd:t,args:r,cwd:s,output:i,options:l}){const u=s?` in ${s}}`:"",d=`NodeExecServer run: ${t} ${r?.join(" ").replace(/\n/g,"\\n")??""}${u}`;i.write(d),l?.verbose&&i.write(`NodeExecServer: ${n.platform} - ${n.platform}, env:`);const h={windowsHide:l?.windowsHide,shell:l?.shell,env:e,cwd:s,windowsVerbatimArguments:l?.windowsVerbatimArguments,stdio:"pipe"},f=o.spawn(t,r,h),p=a(f.stdout),g=a(f.stderr);return{stdin:(m=f.stdin,{id:c++,write(e){m.write(e)},end(){m.end()}}),stdout:p,stderr:g,exit:new Promise(((e,t)=>{f.once("error",(e=>{l?.verbose&&i.write(`NodeExecServer: Error ${e.message}`),t(e)})),f.once("exit",((t,r)=>{l?.verbose&&i.write(`NodeExecServer: Exit ${t} ${r}`),Promise.all([p.onEnd,g.onEnd]).then((()=>{e({status:t??0,message:r??void 0})}))}))})),async terminate(){f.kill("SIGKILL")}};var m},acquireCli(){throw new Error("Not implemented")},spawnCli(){throw new Error("Not implemented")},serve(){throw new Error("Not implemented")},fs:{async stat(e){try{const t=await i.promises.stat(e);let r=t.isFile()?s.FileType.File:t.isDirectory()?s.FileType.Directory:s.FileType.Unknown;return t.isSymbolicLink()&&(r|=s.FileType.SymbolicLink),{type:r}}catch(e){return}}},getEnv:async()=>({env:process.env,osRelease:n.release(),osPlatform:function(){switch(n.platform()){case"win32":return"win32";case"darwin":return"darwin";default:return"linux"}}()})}};const s=r(7153),o=r(5317),n=r(857),i=r(9896);function a(e,t){const r=new u,s=new l;return{id:c++,onData(o,n,i){const a=s.event(o,n,i);return 1===s.size&&(e.on("data",(e=>{t?.write(`toReadStream: on('data')) : ${e.length}`),s.fire(e)})),e.on("end",(()=>{t?.write("toReadStream: end)"),r.complete()}))),a},onEnd:r.p}}let c=2e4;class l{constructor(){this.event=(e,t,r)=>{const s=this.add(t?e.bind(t):e);return Array.isArray(r)&&r.push(s),s}}get size(){return this.listeners?"function"==typeof this.listeners?1:this.listeners.length:0}fire(e){if(this.listeners)if("function"==typeof this.listeners)this.listeners(e);else for(const t of this.listeners)t(e)}dispose(){this.listeners=void 0}add(e){return this.listeners?"function"==typeof this.listeners?this.listeners=[this.listeners,e]:this.listeners.push(e):this.listeners=e,{dispose:()=>this.rm(e)}}rm(e){if(!this.listeners)return;if("function"==typeof this.listeners)return void(this.listeners===e&&(this.listeners=void 0));const t=this.listeners.indexOf(e);-1!==t&&(2===this.listeners.length?this.listeners=0===t?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,t).concat(this.listeners.slice(t+1)))}}t.EventEmitter=l;class u{get isRejected(){return this.rejected}get isResolved(){return this.resolved}get isSettled(){return this.rejected||this.resolved}constructor(){this.rejected=!1,this.resolved=!1,this.p=new Promise(((e,t)=>{this.completeCallback=e,this.errorCallback=t}))}complete(e){this.completeCallback(e),this.resolved=!0}error(e){this.errorCallback(e),this.rejected=!0}}},5569:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DownloadProgress=t.MakeDefaultRequest=t.DownloadRequest=t.FatalErrorOccuredNotification=t.PortResolvedNotification=t.LogNotification=t.ProgressNotification=void 0;const s=r(4590);t.ProgressNotification=new s.NotificationType("progressNotification"),t.LogNotification=new s.NotificationType("logNotification"),t.PortResolvedNotification=new s.NotificationType("portResolvedNotification"),t.FatalErrorOccuredNotification=new s.NotificationType("fatalErrorOccuredNotification"),t.DownloadRequest=new s.RequestType("downloadRequest"),t.MakeDefaultRequest=new s.RequestType("makeDefault"),t.DownloadProgress=new s.ProgressType},9449:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setupRemoteServer=async function(e,t){const r=e.logger,g=await(0,c.getWSLExecServer)((()=>Promise.resolve(t)),void 0,r);return new Promise((async t=>{let v,w="",y=0,S="";const E=[];let _,b="";const x=`${o.randomInt(4294967295)}-${o.randomInt(4294967295)}-${o.randomInt(4294967295)}-${o.randomInt(4294967295)}`,L=(e,r,s,o=!1,n=!0,i=!0,a)=>{clearTimeout(F),t({kind:"failure",message:e,wslVersion:b,checkLog:s,handled:o,modal:n,reason:r,isRecoverable:i,learnMoreLink:a,platform:v?.platform})};async function C(o){if(clearTimeout(F),_)try{const s=new a.WSLServerProxy(e.distro,g,r,e.enableDebug),n=await s.start(_,o);e.onExit.push((()=>s.dispose())),t({kind:"success",port:n,wslVersion:b,connectionToken:x,platform:v?.platform})}catch(e){L(s.t("Exception while setting up the WSL server proxy: {0}",String(e)),l.FailureReason.Undefined,!0)}else L(s.t("Did not receive location of the remote node executable"),l.FailureReason.Undefined,!0)}const T=t=>{const r=t.match(/(\d+)%$/);let s=0;if(r){const e=Math.min(parseInt(r[1],10),100);0===e&&(y=0),e>y&&(s=e-y,y=e)}const o=t;(S!==o||s>0)&&(S=o,e.sendProgress({increment:45*s/100,message:o}))},N=()=>{let t=!1;if(O)O=!1,k=0,W&&(e.sendProgress({increment:0,message:s.t("Installing WSL components")}),W=!1);else if(k++,k>d/u)return void L(s.t("VS Code Server for WSL failed to start. No messages received for {0}s",Math.floor(d/1e3)),l.FailureReason.Timeout,!0);return R.length&&(r.write(R),t=(t=>{for(let r=0;r<t.length;r++){const s=t.charCodeAt(r);if(10===s){const t=w;w="";let r=t.match(/^WSL-shell-PID: ([\d]+)/);if(r){if("2"===e.wslVersion){const t=r[1];e.onExit.push((()=>f(g,e.distro,t)))}continue}if(r=t.match(/^Extension host agent listening on (\d+)/),r)return C(parseInt(r[1],10)),!0;if(r=t.match(/^IP Address: ([\d\.]+)/),r){E.push(r[1]);continue}if(r=t.match(/^WSL version: (.+)/),r){b=r[1];continue}if(r=t.match(/^Node executable: (.+)/),r){_=r[1];continue}T(t)}else 8===s?w.length>0&&(w=w.substr(0,w.length-1)):w+=t.charAt(r)}return T(w),!1})(R),R=""),$.length&&(r.write($,l.LogLevel.error),$=""),t};let R="",$="",O=!1,k=0,W=!0;if(!g.isExecAndDistroArgumentSupported()&&!(0,i.compareCaseInsensitive)(e.defaultDistro,e.distro)&&!await e.setDefaultDistro(e.distro,e.defaultDistro))return void L(s.t("To open a non-distro, the WSL extension requires a newer version of WSL: ({0}).",c.WIN10_1903.label),l.FailureReason.WSLUpdateRequired,!1,!0);const{commit:P,quality:M,serverDataFolderName:D}=e.productConfiguration;if(P&&!M)return void L(s.t("VSCode Client ({0}) does not define a quality.",e.appRoot),l.FailureReason.Undefined,!0);const q=D||".vscode-remote";let I,A;if(P){try{v=await async function(e,t,s){const o="install-found ",n=`if [ -d ~/${t}/bin/${s} ]; then printf '${o}'; fi; if [ -f /etc/alpine-release ]; then printf 'alpine-'; fi; if [ -s ~/${t}/bin/legacy-mode ]; then printf 'legacy-'; fi; uname -m;`;r.write(`Probing if server is already installed: ${n}`);try{const t=await(0,c.runExec)(await g.executeDistroShellCommand(e,n));if(t.status)throw new Error(`Failed to probe if server is already installed: code: ${t.status}, ${t.stderr}, ${t.stdout}`);{const e=t.stdout.trim();r.write(`Probing result: ${e}`);const s=e.startsWith(o),n=s?e.substring(14):e,i=function(e){switch(e){case"x86_64":return"linux-x64";case"legacy-x86_64":return"linux-legacy-x64";case"aarch64":return"linux-arm64";case"legacy-aarch64":return"linux-legacy-arm64";case"alpine-x86_64":return"linux-alpine";case"alpine-aarch64":return"alpine-arm64";default:return}}(n);return i||r.write(`${n} is an unsupported platform. Please file a feature request.`,l.LogLevel.error),{installFound:s,platform:i}}}catch(e){throw new Error(`Failed to probe if server is already installed: code: ${e.message}`)}}(e.distro,q,P),v.installFound?r.write("Server install found in WSL"):r.write(`No server install found in WSL, needs ${v.platform??"unknown"}`)}catch(e){if(r.write(`Unable to detect if server is already installed: ${e}`,l.LogLevel.error),"string"==typeof e.message&&-1!==e.message.indexOf("https://aka.ms/wsl2kernel")){const e=s.t("WSL 2 requires an update to its kernel component. Click on 'Learn More' for more information.");L(e,l.FailureReason.WSLUpdateRequired,!1,!1,!1,!0,"https://aka.ms/wsl2kernel")}g.windowsBuildNumber<=c.WIN10_1803.build&&r.write(`When using Alpine on ${c.WIN10_1803.label}, make sure that 'bash' is installed. ('apk update && apk add bash')${e}`,l.LogLevel.error)}if(v&&!v.installFound&&v.platform){r.write("Getting server from client side");let t=0;try{I=await e.sendDownloadRequest(P,v.platform,(r=>{const o=Math.ceil(45*r.received/r.total);o>t&&(e.sendProgress({increment:o-t,message:s.t("Downloading server...")}),t=o),k=0})),r.write(`Server available at ${I}`)}catch(e){r.write(`Unable to download server on client side: ${e}. Will try to download on WSL side.`,l.LogLevel.error)}}else e.sendProgress({increment:90,message:s.t("Connecting to server...")})}P&&e.useScriptlessStartup?(I&&(e.sendProgress({increment:0,message:s.t("Unpacking server...")}),await async function(t,s,o){const i={useDefaultShell:!0,options:{windowsVerbatimArguments:!0}},a=`$HOME/${t}/bin`;{r.write(`Remove old installs from ${a}`);const t=await g.executeDistroShellCommand(e.distro,`'if [ -d "${a}" ]; then rm -rf "${a}"/????????????????????????????????????????; rm -rf "${a}"/????????????????????????????????????????-*; fi'`,i),s=await(0,c.runExecWithLogger)(t,r);s&&r.write(`Failed to remove old installs ${a}: error code ${s}`)}const l=`${a}/${s}-${(new Date).getTime()}`;{r.write(`Create directory ${l}`);const t=await g.executeDistroShellCommand(e.distro,`'mkdir -p "${l}"'`,i),s=await(0,c.runExecWithLogger)(t,r);if(s)throw new Error(`Failed to create directory ${l}: error code ${s}`)}{r.write(`Extract server from ${o} to ${l}`);const t=await g.executeDistroShellCommand(e.distro,`'tar -xz -C "${l}" --strip-components 1'`,i),s=await(0,c.runExecWithLogger)(t,r,void 0,n.createReadStream(o));if(s)throw new Error(`Failed to extract server from ${o} to ${l}: error code ${s}`)}{const t=`${a}/${s}`;r.write(`Move directory ${l} to ${t}`);const o=await g.executeDistroShellCommand(e.distro,`'mv "${l}" "${t}"'`,i),n=await(0,c.runExecWithLogger)(o,r);if(n)throw new Error(`Failed to move directory ${l}: error code ${n}`)}}(q,P,I)),A=await async function(t,s,o){const n=`$HOME/${t}/server-env-setup`,i=`$HOME/${t}/bin/${s}/bin/${e.productConfiguration.serverApplicationName}`,a=m(o);r.write(`Starting server at ${i}...`);const c=[`if [ -f "${n}" ]; then echo "sourcing ${t}/server-env-setup"; . "${n}"; fi`,`printf "WSL-shell-PID: $$\nWSL version: $(uname -r)\nNode executable: $HOME/${t}/bin/${s}/node\n"`,`"${i}" ${a.join(" ")}`];return await g.executeDistroShellCommand(e.distro,`'${c.join(";\n")}'`,{useDefaultShell:!0,options:{windowsVerbatimArguments:!0}})}(q,P,x)):A=P?await async function(t,s,o,n){const i=g.isWSLEnvAvailable(),a=m(o);let c=`"${i?"$VSCODE_WSL_EXT_LOCATION":"."}/scripts/wslServer.sh" ${s} ${e.productConfiguration.quality||"insider"} ${e.productConfiguration.serverApplicationName} ${t} ${a.join(" ")}`;e.enableDebug&&(c="env && VSCODE_WSL_DEBUG_INFO=true "+c),c=`'${c}'`;const l=p(g.env);if(i){const t=[];l.VSCODE_WSL_EXT_LOCATION=e.wslExtensionLocation,t.push("VSCODE_WSL_EXT_LOCATION/up"),n&&(l.VSCODE_SERVER_TAR=n,t.push("VSCODE_SERVER_TAR/up")),l.WSLENV&&t.push(g.env.WSLENV),l.WSLENV=t.join(":")}const u=i?void 0:e.wslExtensionLocation,d=await g.executeDistroShellCommand(e.distro,c,{env:l,cwd:u,useDefaultShell:!0,options:{windowsVerbatimArguments:!0}});return e.enableDebug&&r.write(`Running with cwd: ${u}, env: ${JSON.stringify(l,null,"  ")}`),d}(q,P,x,I):await async function(t){let s=`"$VSCODE_WSL_EXT_LOCATION/scripts/wslServer-dev.sh" "$VSCODE_WSL_APP_ROOT" ${m(t).join(" ")}`;e.enableDebug&&(s="env && VSCODE_WSL_DEBUG_INFO=true "+s),s=`'${s}'`;const o=p(g.env),n=[];o.VSCODE_WSL_EXT_LOCATION=e.wslExtensionLocation,n.push("VSCODE_WSL_EXT_LOCATION/up"),o.VSCODE_WSL_APP_ROOT=e.appRoot,n.push("VSCODE_WSL_APP_ROOT/up"),o.WSLENV&&n.push(g.env.WSLENV),o.WSLENV=n.join(":");const i=await g.executeDistroShellCommand(e.distro,s,{env:o,useDefaultShell:!0,options:{windowsVerbatimArguments:!0}});return e.enableDebug&&r.write(`Running with env: ${JSON.stringify(o,null,"  ")}`),i}(x);const F=setInterval(N,u);A.stdout.onData((e=>{R+=h.decode(e),O=!0})),A.stderr.onData((e=>{$+=h.decode(e),O=!0})),A.exit.then((e=>{if(99===e.status){const e=s.t("Visual Studio Code can not run on this OS. Click on 'Learn More' for more information.");L(e,l.FailureReason.OSIncompatible,!1,!1,!1,!1,"https://aka.ms/vscode-remote/faq/old-linux")}else if(100===e.status){const e=s.t("Visual Studio Code needs to run in legacy mode on this OS version. Click on 'Learn More' for more information.");L(e,l.FailureReason.NeedsLegacyServer,!1,!1,!1,!1,"https://aka.ms/vscode-remote/faq/old-linux")}N()||L("VS Code Server for WSL closed unexpectedly.",l.FailureReason.ServerCloseError,!0)}),(e=>{N()||L(`VS Code Server for WSL failed with error:\r\n${e.message}`,l.FailureReason.ServerScriptError,!0)}))}));function m(t){const r=[];return r.push("--host=127.0.0.1"),r.push("--port=0"),r.push(`--connection-token=${t}`),r.push("--use-host-proxy"),r.push("--without-browser-env-var"),r.push("--disable-websocket-compression"),r.push("--accept-server-license-terms"),"1"===e.wslVersion&&0!==e.fileWatcherPolling&&r.push(`--file-watcher-polling=${e.fileWatcherPolling}`),e.enableDebug&&r.push("--log=trace"),e.enableTelemetry||r.push("--disable-telemetry"),r.push(`--telemetry-level=${e.telemetryLevel}`),r}};const s=r(5747),o=r(6982),n=r(9896),i=r(2552),a=r(9534),c=r(7153),l=r(5732),u=300,d=9e4,h=new TextDecoder;async function f(e,t,r){const s=["kill",r];try{await(0,c.runExec)(await e.executeDistroExe(t,s))}catch(e){}}function p(e){const t={...e},r=Object.keys(t);for(const e of r)e.match(/^(ELECTRON_|VSCODE_)/)&&delete t[e];return t}},5732:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.FailureReason=t.LogLevel=void 0,function(e){e[e.info=1]="info",e[e.error=2]="error",e[e.debug=3]="debug"}(r||(t.LogLevel=r={})),function(e){e.ServerScriptError="servererror",e.ServerCloseError="serverclose",e.Timeout="timeout",e.WSLNotFound="wslnotfound",e.WSLUpdateRequired="wslupdaterequired",e.OSIncompatible="osincompatible",e.NeedsLegacyServer="needslegacyserver",e.DaemonError="daemonerror",e.DaemonClosed="daemonclosed",e.Undefined="undefined"}(s||(t.FailureReason=s={}))},4565:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getProductConfiguration=function(e){if(!n){const t=s.readFileSync(o.join(e,"product.json")).toString();n=JSON.parse(t)}return n};const s=r(9896),o=r(6928);let n},2552:(e,t)=>{function r(e,t){return e.length===t.length&&(e===t||e.toLowerCase()===t.toLowerCase())}Object.defineProperty(t,"__esModule",{value:!0}),t.AuthorityHierarchy=void 0,t.compareCaseInsensitive=r,t.isEqualAuthority=function(e,t){return void 0===e?void 0===t:void 0!==t&&r(e,t)},t.isDockerDesktopDistro=function(e){return/^docker-desktop(-data)?$/.test(e)},t.isWSL1=function(e){return-1!==e.indexOf("Microsoft")},t.getAuthorityFromDistro=function(e="default",t){return t?`wsl+${e}@${t}`:"wsl+"+e},t.isAuthorityWsl=function(e){return e.startsWith("wsl+")},t.getDistroFromAuthority=function(e){let t,r;if(e.startsWith("wsl+")&&(t=e.substring(4)),!t)return;const s=t.indexOf("@"),o=t.indexOf("%40"),n=Math.min(-1===s?1/0:s,-1===o?1/0:o);return isFinite(n)&&(r=t.slice(n+1),t=t.slice(0,n)),"default"===t&&(t=void 0),{hostAuthority:r,distro:t}},t.getRemoteName=function(e){const t=e.indexOf("+");return-1!==t?e.substring(0,t):e},t.onceSuccessfully=function(e){let t;return()=>(void 0!==t||(t=e(),t.catch((()=>{t=void 0}))),t)},t.shouldActivateForAuthority=function(e,t){const r=["tunnel+","wsl+"];return!1!==e.workspace.getConfiguration("remote.SSH").get("useExecServer",!0)&&r.push("ssh-remote+"),r.some((e=>t.startsWith(e)))};class s{static parse(e){return new s(e,e.split(/@|%40/g).reverse())}get length(){return this.parts.length}get host(){return this.last.startsWith("wsl+")?1===this.parts.length?void 0:this.parts.slice(0,-1).reverse().join("@"):this.parts.slice().reverse().join("@")}get last(){return this.parts[this.parts.length-1]}constructor(e,t){this.value=e,this.parts=t}has(e){const t=e+"+";return this.parts.some((e=>e.startsWith(t)))}toString(){return this.parts.join(" > ")}}t.AuthorityHierarchy=s},7153:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WSLExecError=t.WSLExecErrorCode=t.WIN10_1803=t.WIN10_1903=t.WIN10_2004=t.WIN10_21H1=t.FileType=void 0,t.getWSLExecServer=async function(e,r,s){const u=c.get(r)||await e().then((e=>e.getEnv()));c.set(r,u);const{env:d,osPlatform:h,osRelease:f}=u,p="win32"===h&&f&&/(\d+)\.(\d+)\.(\d+)/g.exec(f),g=p&&4===p.length?parseInt(p[3]):0;function m(...e){const t=d.SystemRoot;if(t)return function(...e){let t=e[0];for(let r=1;r<e.length;r++){const s=e[r];t.endsWith("\\")&&s.startsWith("\\")||(t+="\\"),t+=s}return t}(t,d.PROCESSOR_ARCHITEW6432?"Sysnative":"System32",...e)}function v(){return m("wslconfig.exe")}function w(){return g>=16299}function y(){return m(w()?"wsl.exe":"bash.exe")}async function S(t,r){const o=y();if(!o)throw new a(i.WSLCommandNotFound);const n={windowsVerbatimArguments:!0,verbose:r},c={...process.env,WSL_UTF8:"0"};return l(await e().then((e=>e.exec({cmd:o,args:t,output:s,env:c,options:n}))),"utf16le",void 0,r?s:void 0)}const E=(0,o.onceSuccessfully)((async()=>{if("win32"!==h)return s.write("WSL feature installed: false (not win32)"),!1;if(!(g>=22e3)){const t=m("lxss","LxssManager.dll");if(t)try{const r=await e().then((e=>e.fs.stat(t))),o=!!r&&!!(r.type|n.File);return s.write(`WSL feature installed: ${o} (dll path)`),!0}catch(e){}return s.write("WSL feature installed: false (no dll path)"),!1}try{const e=!(await S(["--status"])).status;return s.write(`WSL feature installed: ${e} (wsl --status)`),e}catch(e){throw s.write(`WSL feature installed: false (wsl --status failed, ${e.message})`),new a(i.WSLStatusFailed,e.message)}}));function _(e,t,r){const s=[];return x()?(s.push("-d",e),!0!==r&&s.push("-e"),s.push("sh","-c",t)):w()?s.push("sh","-c",t):s.push("-c",t),s}function b(t,r,{env:o,cwd:n,options:c,useDefaultShell:l}={}){const u=y();if(!u)throw new a(i.WSLCommandNotFound);const d=_(t,r,l);return e().then((e=>e.exec({cmd:u,args:d,output:s,env:o,cwd:n,options:c})))}function x(){return g>=17666}return{windowsBuildNumber:g,hostAuthority:r,getWSLConfigExecutablePath:v,getWSLExecutablePath:y,runWSLCommandLine:S,runWSLConfigCommandLine:async function(t,r){const o=v();if(!o)throw new a(i.WSLCommandNotFound);const n={windowsVerbatimArguments:!0,verbose:r},c={...process.env,WSL_UTF8:"0"};return l(await e().then((e=>e.exec({cmd:o,args:t,output:s,env:c,options:n}))),"utf16le",void 0,r?s:void 0)},isWSLInstalled:E,executeDistroShellCommand:b,getDistroShellCommandArgs:_,executeDistroExe:function(t,r,{env:o,cwd:n,options:c,useDefaultShell:l}={}){const u=y();if(!u)throw new a(i.WSLCommandNotFound);const d=[];return x()?(d.push("-d",t),!0!==l&&d.push("-e"),d.push(...r)):d.push(...r),e().then((e=>e.exec({cmd:u,args:d,output:s,env:o,cwd:n,options:c})))},executeWslPath:async function(e,t,r){let s;if(r){const r='echo "$VSCODE_WSL_PATH"',o={env:{WSLENV:"VSCODE_WSL_PATH/up",VSCODE_WSL_PATH:t}};s=await b(e,r,o)}else{const r='wslpath -w "$VSCODE_WSL_PATH"',o={env:{WSLENV:"VSCODE_WSL_PATH/u",VSCODE_WSL_PATH:t}};s=await b(e,r,o)}const o=await l(s);if(!o.status)return o.stdout.trim();throw new a(i.WSLPathConversionFailed,o.stderr)},getExecServer:e,isDistroEnvVarAvailable:()=>g>=t.WIN10_1903.build,isWSLPathAvailable:()=>g>=17046,isWSL2Available:()=>g>=18917||g>=t.WIN10_1903.build&&"maybe",isWSLEnvAvailable:()=>g>=17063,isExecAndDistroArgumentSupported:x,isWSLInExplorerAvailable:()=>g>=18342,env:d,osPlatform:h}},t.runExec=l,t.runExecWithLogger=async function(e,t,r,o){const n=new TextDecoder(r);return new Promise(((r,i)=>{e.stdout.onData((e=>{t.write(n.decode(e))})),e.stderr.onData((e=>{t.write(n.decode(e),s.LogLevel.error)})),e.exit.then((({status:e})=>{try{r(e||0)}catch(e){i(e)}}),i),o&&(o.on("data",(t=>{e.stdin.write(t)})),o.on("end",(()=>{e.stdin.end()})))}))};const s=r(5732),o=r(2552);var n,i;!function(e){e[e.Unknown=0]="Unknown",e[e.File=1]="File",e[e.Directory=2]="Directory",e[e.SymbolicLink=64]="SymbolicLink"}(n||(t.FileType=n={})),t.WIN10_21H1={label:"Windows 10, May 2021 Update, version 21H1",build:19043},t.WIN10_2004={label:"Windows 10, May 2020 Update, version 2004",build:19041},t.WIN10_1903={label:"Windows 10, May 2019 Update, version 1903",build:18362},t.WIN10_1803={label:"Windows 10, April 2018 Update, version 1803",build:17134},function(e){e[e.WSLCommandNotFound=0]="WSLCommandNotFound",e[e.SystemRootNotFound=1]="SystemRootNotFound",e[e.WSLStatusFailed=2]="WSLStatusFailed",e[e.WSLPathConversionFailed=3]="WSLPathConversionFailed"}(i||(t.WSLExecErrorCode=i={}));class a extends Error{constructor(e,t){super(t),this.wslError=e}}t.WSLExecError=a;const c=new Map;async function l(e,t,r,s){return new Promise(((o,n)=>{const i=[],a=[];e.stdout.onData((e=>{i.push(e),s?.write(`runExec stdout (len: ${e.length}): ${JSON.stringify(e)}`)})),e.stderr.onData((e=>{a.push(e),s?.write(`runExec stderr (len: ${e.length}): ${Buffer.from(e).toString("hex")}`)})),e.exit.then((({status:e})=>{try{const r=Buffer.concat(i).toString(t),n=Buffer.concat(a).toString(t);s?.write(`runExec exit (stdout: chucks: ${i.length}, len: ${r.length}, stderr: chucks: ${a.length}, len: ${n.length})`),0===r.length&&i.length&&s?.write(JSON.stringify(Buffer.concat(i))),o({stdout:r,stderr:n,status:e||0})}catch(e){s?.write(`runExec exit (error: ${e})`),n(e)}}),n),r&&(r.on("data",(t=>{e.stdin.write(t)})),r.on("end",(()=>{e.stdin.end()})))}))}},9534:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WSLServerProxy=void 0;const s=r(9278),o=r(5732);t.WSLServerProxy=class{constructor(e,t,r,s){this.distro=e,this.execServer=t,this.logger=r,this.isDebug=s,this.forwardedPorts=new Set,this.execId=0}start(e,t){return new Promise(((r,n)=>{const i=new Set,a=s.createServer({pauseOnConnect:!0},(async r=>{try{const s=a.address().port,n=this.execId++,c=[e,"-e",`const net = require('net');\n\t\t\t\t\t\tprocess.stdin.pause();\n\t\t\t\t\t\tconst client = net.createConnection({ host: '127.0.0.1', port: ${t} }, () => {\n\t\t\t\t\t\t\tclient.pipe(process.stdout);\n\t\t\t\t\t\t\tprocess.stdin.pipe(client);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tclient.on('close', function (hadError) {\n\t\t\t\t\t\t\tconsole.error(hadError ? 'Remote close with error' : 'Remote close');\n\t\t\t\t\t\t\tprocess.exit(hadError ? 1 : 0);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tclient.on('error', function (err) {\n\t\t\t\t\t\t\tprocess.stderr.write(err && (err.stack || err.message) || String(err));\n\t\t\t\t\t\t});`.replace(/\s+/g," ")];this.isDebug&&this.logger.write(`Using executable (${n}) to forward requests from local ${s} to remote ${t}`,o.LogLevel.debug);const l=await this.execServer.executeDistroExe(this.distro,c);let u=!1;l.exit.then((({status:e,message:t})=>{u||(i.delete(r),r.end()),this.isDebug&&this.logger.write(`Exec (${n}) has terminated ${u?"(local socket closed)":""} with status ${e} and message ${t}.`,o.LogLevel.debug)})).catch((e=>{this.logger.write(`Exec (${n}) has errored: ${e}`)})),this.isDebug&&l.stderr.onData((e=>{this.logger.write(`Exec (${n}) stderr: ${Buffer.from(e).toString()}`,o.LogLevel.debug)})),r.on("close",(e=>{this.isDebug&&this.logger.write(`Exec (${n}): Local close${e?" with error":""}`,o.LogLevel.debug),u=!0,i.delete(r),l.terminate().catch(console.error)})),r.on("data",(e=>{l.stdin.write(e)})),r.on("end",(()=>{l.stdin.end()})),l.stdout.onData((e=>{r.write(e)})),l.stdout.onEnd.then((()=>{r.end()})),r.resume(),i.add(r)}catch(e){this.logger.write("Exception caught when running forwarding executable"+e,o.LogLevel.error),console.error(e)}}));a.on("listening",(()=>{const e=a.address().port,s={targetPort:t,server:a,localPort:e,connections:i};a.on("close",(()=>{this.forwardedPorts.delete(s)})),this.forwardedPorts.add(s),this.logger.write(`Started local proxy server on ${e}.`),r(e)})),a.on("error",(e=>{!e||"EADDRINUSE"!==e.code&&"EACCES"!==e.code?n(e):a.listen(0,"127.0.0.1")})),a.on("close",(()=>{n(new Error("Closed"))})),a.listen(0,"127.0.0.1")}))}stopForwarding(e){return new Promise(((t,r)=>{e.server.close((e=>{e?r(e):t()}));for(const t of e.connections)t.destroy()}))}async dispose(){for(const e of this.forwardedPorts.values())try{await this.stopForwarding(e)}catch(e){this.logger.write("Exception thrown when closing the server proxy: "+e,o.LogLevel.error)}}}},5360:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(8898),o=r(311);var n;!function(e){e.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:s.Event.None}),e.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:s.Event.None}),e.is=function(t){let r=t;return r&&(r===e.None||r===e.Cancelled||o.boolean(r.isCancellationRequested)&&!!r.onCancellationRequested)}}(n=t.CancellationToken||(t.CancellationToken={}));const i=Object.freeze((function(e,t){let r=setTimeout(e.bind(t),0);return{dispose(){clearTimeout(r)}}}));class a{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?i:(this._emitter||(this._emitter=new s.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}}t.CancellationTokenSource=class{get token(){return this._token||(this._token=new a),this._token}cancel(){this._token?this._token.cancel():this._token=n.Cancelled}dispose(){this._token?this._token instanceof a&&this._token.dispose():this._token=n.None}}},8898:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),(t.Disposable||(t.Disposable={})).create=function(e){return{dispose:e}},function(e){const t={dispose(){}};e.None=function(){return t}}(t.Event||(t.Event={}));class r{add(e,t=null,r){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(r)&&r.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(this._callbacks){for(var r=!1,s=0,o=this._callbacks.length;s<o;s++)if(this._callbacks[s]===e){if(this._contexts[s]===t)return this._callbacks.splice(s,1),void this._contexts.splice(s,1);r=!0}if(r)throw new Error("When adding a listener with a context, you should remove it with the same context")}}invoke(...e){if(!this._callbacks)return[];for(var t=[],r=this._callbacks.slice(0),s=this._contexts.slice(0),o=0,n=r.length;o<n;o++)try{t.push(r[o].apply(s[o],e))}catch(e){console.error(e)}return t}isEmpty(){return!this._callbacks||0===this._callbacks.length}dispose(){this._callbacks=void 0,this._contexts=void 0}}class s{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,o)=>{let n;return this._callbacks||(this._callbacks=new r),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t),n={dispose:()=>{this._callbacks.remove(e,t),n.dispose=s._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this)}},Array.isArray(o)&&o.push(n),n}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}}t.Emitter=s,s._noop=function(){}},311:(e,t)=>{function r(e){return"string"==typeof e||e instanceof String}function s(e){return Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.boolean=function(e){return!0===e||!1===e},t.string=r,t.number=function(e){return"number"==typeof e||e instanceof Number},t.error=function(e){return e instanceof Error},t.func=function(e){return"function"==typeof e},t.array=s,t.stringArray=function(e){return s(e)&&e.every((e=>r(e)))}},8446:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.None=0,e.First=1,e.Last=2}(r=t.Touch||(t.Touch={})),t.LinkedMap=class{constructor(){this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}has(e){return this._map.has(e)}get(e){const t=this._map.get(e);if(t)return t.value}set(e,t,s=r.None){let o=this._map.get(e);if(o)o.value=t,s!==r.None&&this.touch(o,s);else{switch(o={key:e,value:t,next:void 0,previous:void 0},s){case r.None:this.addItemLast(o);break;case r.First:this.addItemFirst(o);break;case r.Last:default:this.addItemLast(o)}this._map.set(e,o),this._size++}}delete(e){const t=this._map.get(e);return!!t&&(this._map.delete(e),this.removeItem(t),this._size--,!0)}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");const e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let r=this._head;for(;r;)t?e.bind(t)(r.value,r.key,this):e(r.value,r.key,this),r=r.next}forEachReverse(e,t){let r=this._tail;for(;r;)t?e.bind(t)(r.value,r.key,this):e(r.value,r.key,this),r=r.previous}values(){let e=[],t=this._head;for(;t;)e.push(t.value),t=t.next;return e}keys(){let e=[],t=this._head;for(;t;)e.push(t.key),t=t.next;return e}addItemFirst(e){if(this._head||this._tail){if(!this._head)throw new Error("Invalid list");e.next=this._head,this._head.previous=e}else this._tail=e;this._head=e}addItemLast(e){if(this._head||this._tail){if(!this._tail)throw new Error("Invalid list");e.previous=this._tail,this._tail.next=e}else this._head=e;this._tail=e}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head)this._head=e.next;else if(e===this._tail)this._tail=e.previous;else{const t=e.next,r=e.previous;if(!t||!r)throw new Error("Invalid list");t.previous=r,r.next=t}}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(t===r.First||t===r.Last)if(t===r.First){if(e===this._head)return;const t=e.next,r=e.previous;e===this._tail?(r.next=void 0,this._tail=r):(t.previous=r,r.next=t),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e}else if(t===r.Last){if(e===this._tail)return;const t=e.next,r=e.previous;e===this._head?(t.previous=void 0,this._head=t):(t.previous=r,r.next=t),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e}}}},4590:(e,t,r)=>{function s(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0});const o=r(311),n=r(5043);t.RequestType=n.RequestType,t.RequestType0=n.RequestType0,t.RequestType1=n.RequestType1,t.RequestType2=n.RequestType2,t.RequestType3=n.RequestType3,t.RequestType4=n.RequestType4,t.RequestType5=n.RequestType5,t.RequestType6=n.RequestType6,t.RequestType7=n.RequestType7,t.RequestType8=n.RequestType8,t.RequestType9=n.RequestType9,t.ResponseError=n.ResponseError,t.ErrorCodes=n.ErrorCodes,t.NotificationType=n.NotificationType,t.NotificationType0=n.NotificationType0,t.NotificationType1=n.NotificationType1,t.NotificationType2=n.NotificationType2,t.NotificationType3=n.NotificationType3,t.NotificationType4=n.NotificationType4,t.NotificationType5=n.NotificationType5,t.NotificationType6=n.NotificationType6,t.NotificationType7=n.NotificationType7,t.NotificationType8=n.NotificationType8,t.NotificationType9=n.NotificationType9;const i=r(8919);t.MessageReader=i.MessageReader,t.StreamMessageReader=i.StreamMessageReader,t.IPCMessageReader=i.IPCMessageReader,t.SocketMessageReader=i.SocketMessageReader;const a=r(7159);t.MessageWriter=a.MessageWriter,t.StreamMessageWriter=a.StreamMessageWriter,t.IPCMessageWriter=a.IPCMessageWriter,t.SocketMessageWriter=a.SocketMessageWriter;const c=r(8898);t.Disposable=c.Disposable,t.Event=c.Event,t.Emitter=c.Emitter;const l=r(5360);t.CancellationTokenSource=l.CancellationTokenSource,t.CancellationToken=l.CancellationToken;const u=r(8446);var d,h,f,p,g,m,v,w;s(r(3696)),s(r(5851)),function(e){e.type=new n.NotificationType("$/cancelRequest")}(d||(d={})),function(e){e.type=new n.NotificationType("$/progress")}(h||(h={})),t.ProgressType=class{constructor(){}},t.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}}),function(e){e[e.Off=0]="Off",e[e.Messages=1]="Messages",e[e.Verbose=2]="Verbose"}(f=t.Trace||(t.Trace={})),function(e){e.fromString=function(t){if(!o.string(t))return e.Off;switch(t=t.toLowerCase()){case"off":default:return e.Off;case"messages":return e.Messages;case"verbose":return e.Verbose}},e.toString=function(t){switch(t){case e.Off:return"off";case e.Messages:return"messages";case e.Verbose:return"verbose";default:return"off"}}}(f=t.Trace||(t.Trace={})),function(e){e.Text="text",e.JSON="json"}(t.TraceFormat||(t.TraceFormat={})),function(e){e.fromString=function(t){return"json"===(t=t.toLowerCase())?e.JSON:e.Text}}(p=t.TraceFormat||(t.TraceFormat={})),function(e){e.type=new n.NotificationType("$/setTraceNotification")}(g=t.SetTraceNotification||(t.SetTraceNotification={})),function(e){e.type=new n.NotificationType("$/logTraceNotification")}(m=t.LogTraceNotification||(t.LogTraceNotification={})),function(e){e[e.Closed=1]="Closed",e[e.Disposed=2]="Disposed",e[e.AlreadyListening=3]="AlreadyListening"}(v=t.ConnectionErrors||(t.ConnectionErrors={}));class y extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,y.prototype)}}function S(e,t,r,s){let i=0,a=0,S=0;const E="2.0";let _,b,x,L,C=Object.create(null),T=Object.create(null),N=new Map,R=new u.LinkedMap,$=Object.create(null),O=Object.create(null),k=f.Off,W=p.Text,P=w.New,M=new c.Emitter,D=new c.Emitter,q=new c.Emitter,I=new c.Emitter,A=new c.Emitter;function F(e){return"req-"+e.toString()}function j(e){}function V(){return P===w.Listening}function U(){return P===w.Closed}function J(){return P===w.Disposed}function H(){P!==w.New&&P!==w.Listening||(P=w.Closed,D.fire(void 0))}function B(){x||0===R.size||(x=setImmediate((()=>{x=void 0,function(){if(0===R.size)return;let e=R.shift();try{n.isRequestMessage(e)?function(e){if(J())return;function r(r,s,o){let i={jsonrpc:E,id:e.id};r instanceof n.ResponseError?i.error=r.toJson():i.result=void 0===r?null:r,X(i,s,o),t.write(i)}function s(r,s,o){let n={jsonrpc:E,id:e.id,error:r.toJson()};X(n,s,o),t.write(n)}!function(e){if(k!==f.Off&&L)if(W===p.Text){let t;k===f.Verbose&&e.params&&(t=`Params: ${JSON.stringify(e.params,null,4)}\n\n`),L.log(`Received request '${e.method} - (${e.id})'.`,t)}else G("receive-request",e)}(e);let i,a,c=C[e.method];c&&(i=c.type,a=c.handler);let u=Date.now();if(a||_){let c=new l.CancellationTokenSource,d=String(e.id);O[d]=c;try{let l;l=void 0===e.params||void 0!==i&&0===i.numberOfParams?a?a(c.token):_(e.method,c.token):o.array(e.params)&&(void 0===i||i.numberOfParams>1)?a?a(...e.params,c.token):_(e.method,...e.params,c.token):a?a(e.params,c.token):_(e.method,e.params,c.token);let h=l;l?h.then?h.then((t=>{delete O[d],r(t,e.method,u)}),(t=>{delete O[d],t instanceof n.ResponseError?s(t,e.method,u):t&&o.string(t.message)?s(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${t.message}`),e.method,u):s(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,u)})):(delete O[d],r(l,e.method,u)):(delete O[d],function(r,s,o){void 0===r&&(r=null);let n={jsonrpc:E,id:e.id,result:r};X(n,s,o),t.write(n)}(l,e.method,u))}catch(t){delete O[d],t instanceof n.ResponseError?r(t,e.method,u):t&&o.string(t.message)?s(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed with message: ${t.message}`),e.method,u):s(new n.ResponseError(n.ErrorCodes.InternalError,`Request ${e.method} failed unexpectedly without providing any details.`),e.method,u)}}else s(new n.ResponseError(n.ErrorCodes.MethodNotFound,`Unhandled method ${e.method}`),e.method,u)}(e):n.isNotificationMessage(e)?function(e){if(J())return;let t,s;if(e.method===d.type.method)s=e=>{let t=e.id,r=O[String(t)];r&&r.cancel()};else{let r=T[e.method];r&&(s=r.handler,t=r.type)}if(s||b)try{!function(e){if(k!==f.Off&&L&&e.method!==m.type.method)if(W===p.Text){let t;k===f.Verbose&&(t=e.params?`Params: ${JSON.stringify(e.params,null,4)}\n\n`:"No parameters provided.\n\n"),L.log(`Received notification '${e.method}'.`,t)}else G("receive-notification",e)}(e),void 0===e.params||void 0!==t&&0===t.numberOfParams?s?s():b(e.method):o.array(e.params)&&(void 0===t||t.numberOfParams>1)?s?s(...e.params):b(e.method,...e.params):s?s(e.params):b(e.method,e.params)}catch(t){t.message?r.error(`Notification handler '${e.method}' failed with message: ${t.message}`):r.error(`Notification handler '${e.method}' failed unexpectedly.`)}else q.fire(e)}(e):n.isResponseMessage(e)?function(e){if(!J())if(null===e.id)e.error?r.error(`Received response message without id: Error is: \n${JSON.stringify(e.error,void 0,4)}`):r.error("Received response message without id. No further error information provided.");else{let t=String(e.id),s=$[t];if(function(e,t){if(k!==f.Off&&L)if(W===p.Text){let r;if(k===f.Verbose&&(e.error&&e.error.data?r=`Error data: ${JSON.stringify(e.error.data,null,4)}\n\n`:e.result?r=`Result: ${JSON.stringify(e.result,null,4)}\n\n`:void 0===e.error&&(r="No result returned.\n\n")),t){let s=e.error?` Request failed: ${e.error.message} (${e.error.code}).`:"";L.log(`Received response '${t.method} - (${e.id})' in ${Date.now()-t.timerStart}ms.${s}`,r)}else L.log(`Received response ${e.id} without active response promise.`,r)}else G("receive-response",e)}(e,s),s){delete $[t];try{if(e.error){let t=e.error;s.reject(new n.ResponseError(t.code,t.message,t.data))}else{if(void 0===e.result)throw new Error("Should never happen.");s.resolve(e.result)}}catch(e){e.message?r.error(`Response handler '${s.method}' failed with message: ${e.message}`):r.error(`Response handler '${s.method}' failed unexpectedly.`)}}}}(e):function(e){if(!e)return void r.error("Received empty message.");r.error(`Received message which is neither a response nor a notification message:\n${JSON.stringify(e,null,4)}`);let t=e;if(o.string(t.id)||o.number(t.id)){let e=String(t.id),r=$[e];r&&r.reject(new Error("The received response has neither a result nor an error property."))}}(e)}finally{B()}}()})))}e.onClose(H),e.onError((function(e){M.fire([e,void 0,void 0])})),t.onClose(H),t.onError((function(e){M.fire(e)}));let z=e=>{try{if(n.isNotificationMessage(e)&&e.method===d.type.method){let r=F(e.params.id),o=R.get(r);if(n.isRequestMessage(o)){let n=s&&s.cancelUndispatched?s.cancelUndispatched(o,j):void 0;if(n&&(void 0!==n.error||void 0!==n.result))return R.delete(r),n.id=o.id,X(n,e.method,Date.now()),void t.write(n)}}!function(e,t){var r;n.isRequestMessage(t)?e.set(F(t.id),t):n.isResponseMessage(t)?e.set(null===(r=t.id)?"res-unknown-"+(++S).toString():"res-"+r.toString(),t):e.set("not-"+(++a).toString(),t)}(R,e)}finally{B()}};function X(e,t,r){if(k!==f.Off&&L)if(W===p.Text){let s;k===f.Verbose&&(e.error&&e.error.data?s=`Error data: ${JSON.stringify(e.error.data,null,4)}\n\n`:e.result?s=`Result: ${JSON.stringify(e.result,null,4)}\n\n`:void 0===e.error&&(s="No result returned.\n\n")),L.log(`Sending response '${t} - (${e.id})'. Processing request took ${Date.now()-r}ms`,s)}else G("send-response",e)}function G(e,t){if(!L||k===f.Off)return;const r={isLSPMessage:!0,type:e,message:t,timestamp:Date.now()};L.log(r)}function Y(){if(U())throw new y(v.Closed,"Connection is closed.");if(J())throw new y(v.Disposed,"Connection is disposed.")}function Z(e){return void 0===e?null:e}function K(e,t){let r,s=e.numberOfParams;switch(s){case 0:r=null;break;case 1:r=Z(t[0]);break;default:r=[];for(let e=0;e<t.length&&e<s;e++)r.push(Z(t[e]));if(t.length<s)for(let e=t.length;e<s;e++)r.push(null)}return r}let Q={sendNotification:(e,...r)=>{let s,n;if(Y(),o.string(e))switch(s=e,r.length){case 0:n=null;break;case 1:n=r[0];break;default:n=r}else s=e.method,n=K(e,r);let i={jsonrpc:E,method:s,params:n};!function(e){if(k!==f.Off&&L)if(W===p.Text){let t;k===f.Verbose&&(t=e.params?`Params: ${JSON.stringify(e.params,null,4)}\n\n`:"No parameters provided.\n\n"),L.log(`Sending notification '${e.method}'.`,t)}else G("send-notification",e)}(i),t.write(i)},onNotification:(e,t)=>{Y(),o.func(e)?b=e:t&&(o.string(e)?T[e]={type:void 0,handler:t}:T[e.method]={type:e,handler:t})},onProgress:(e,t,r)=>{if(N.has(t))throw new Error(`Progress handler for token ${t} already registered`);return N.set(t,r),{dispose:()=>{N.delete(t)}}},sendProgress:(e,t,r)=>{Q.sendNotification(h.type,{token:t,value:r})},onUnhandledProgress:I.event,sendRequest:(e,...r)=>{let s,a,c;if(Y(),function(){if(!V())throw new Error("Call listen() first.")}(),o.string(e))switch(s=e,r.length){case 0:a=null;break;case 1:l.CancellationToken.is(r[0])?(a=null,c=r[0]):a=Z(r[0]);break;default:const e=r.length-1;l.CancellationToken.is(r[e])?(c=r[e],a=2===r.length?Z(r[0]):r.slice(0,e).map((e=>Z(e)))):a=r.map((e=>Z(e)))}else{s=e.method,a=K(e,r);let t=e.numberOfParams;c=l.CancellationToken.is(r[t])?r[t]:void 0}let u=i++,h=new Promise(((e,r)=>{let o={jsonrpc:E,id:u,method:s,params:a},i={method:s,timerStart:Date.now(),resolve:e,reject:r};!function(e){if(k!==f.Off&&L)if(W===p.Text){let t;k===f.Verbose&&e.params&&(t=`Params: ${JSON.stringify(e.params,null,4)}\n\n`),L.log(`Sending request '${e.method} - (${e.id})'.`,t)}else G("send-request",e)}(o);try{t.write(o)}catch(e){i.reject(new n.ResponseError(n.ErrorCodes.MessageWriteError,e.message?e.message:"Unknown reason")),i=null}i&&($[String(u)]=i)}));return c&&c.onCancellationRequested((()=>{Q.sendNotification(d.type,{id:u})})),h},onRequest:(e,t)=>{Y(),o.func(e)?_=e:t&&(o.string(e)?C[e]={type:void 0,handler:t}:C[e.method]={type:e,handler:t})},trace:(e,t,r)=>{let s=!1,n=p.Text;void 0!==r&&(o.boolean(r)?s=r:(s=r.sendNotification||!1,n=r.traceFormat||p.Text)),k=e,W=n,L=k===f.Off?void 0:t,!s||U()||J()||Q.sendNotification(g.type,{value:f.toString(e)})},onError:M.event,onClose:D.event,onUnhandledNotification:q.event,onDispose:A.event,dispose:()=>{if(J())return;P=w.Disposed,A.fire(void 0);let r=new Error("Connection got disposed.");Object.keys($).forEach((e=>{$[e].reject(r)})),$=Object.create(null),O=Object.create(null),R=new u.LinkedMap,o.func(t.dispose)&&t.dispose(),o.func(e.dispose)&&e.dispose()},listen:()=>{Y(),function(){if(V())throw new y(v.AlreadyListening,"Connection is already listening")}(),P=w.Listening,e.listen(z)},inspect:()=>{console.log("inspect")}};return Q.onNotification(m.type,(e=>{k!==f.Off&&L&&L.log(e.message,k===f.Verbose?e.verbose:void 0)})),Q.onNotification(h.type,(e=>{const t=N.get(e.token);t?t(e.value):I.fire(e)})),Q}t.ConnectionError=y,(t.ConnectionStrategy||(t.ConnectionStrategy={})).is=function(e){let t=e;return t&&o.func(t.cancelUndispatched)},function(e){e[e.New=1]="New",e[e.Listening=2]="Listening",e[e.Closed=3]="Closed",e[e.Disposed=4]="Disposed"}(w||(w={})),t.createMessageConnection=function(e,r,s,o){s||(s=t.NullLogger);let n=void 0!==(c=e).listen&&void 0===c.read?e:new i.StreamMessageReader(e);var c;let l=function(e){return void 0!==e.write&&void 0===e.end}(r)?r:new a.StreamMessageWriter(r);return S(n,l,s,o)}},8919:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(8898),o=r(311);let n=8192,i=Buffer.from("\r","ascii")[0],a=Buffer.from("\n","ascii")[0];class c{constructor(e="utf8"){this.encoding=e,this.index=0,this.buffer=Buffer.allocUnsafe(n)}append(e){var t=e;if("string"==typeof e){var r=e,s=Buffer.byteLength(r,this.encoding);(t=Buffer.allocUnsafe(s)).write(r,0,s,this.encoding)}if(this.buffer.length-this.index>=t.length)t.copy(this.buffer,this.index,0,t.length);else{var o=(Math.ceil((this.index+t.length)/n)+1)*n;0===this.index?(this.buffer=Buffer.allocUnsafe(o),t.copy(this.buffer,0,0,t.length)):this.buffer=Buffer.concat([this.buffer.slice(0,this.index),t],o)}this.index+=t.length}tryReadHeaders(){let e,t=0;for(;t+3<this.index&&(this.buffer[t]!==i||this.buffer[t+1]!==a||this.buffer[t+2]!==i||this.buffer[t+3]!==a);)t++;if(t+3>=this.index)return e;e=Object.create(null),this.buffer.toString("ascii",0,t).split("\r\n").forEach((t=>{let r=t.indexOf(":");if(-1===r)throw new Error("Message header must separate key and value using :");let s=t.substr(0,r),o=t.substr(r+1).trim();e[s]=o}));let r=t+4;return this.buffer=this.buffer.slice(r),this.index=this.index-r,e}tryReadContent(e){if(this.index<e)return null;let t=this.buffer.toString(this.encoding,0,e),r=e;return this.buffer.copy(this.buffer,0,r),this.index=this.index-r,t}get numberOfBytes(){return this.index}}(t.MessageReader||(t.MessageReader={})).is=function(e){let t=e;return t&&o.func(t.listen)&&o.func(t.dispose)&&o.func(t.onError)&&o.func(t.onClose)&&o.func(t.onPartialMessage)};class l{constructor(){this.errorEmitter=new s.Emitter,this.closeEmitter=new s.Emitter,this.partialMessageEmitter=new s.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${o.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageReader=l;class u extends l{constructor(e,t="utf8"){super(),this.readable=e,this.buffer=new c(t),this._partialMessageTimeout=1e4}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e,this.readable.on("data",(e=>{this.onData(e)})),this.readable.on("error",(e=>this.fireError(e))),this.readable.on("close",(()=>this.fireClose()))}onData(e){for(this.buffer.append(e);;){if(-1===this.nextMessageLength){let e=this.buffer.tryReadHeaders();if(!e)return;let t=e["Content-Length"];if(!t)throw new Error("Header must provide a Content-Length property.");let r=parseInt(t);if(isNaN(r))throw new Error("Content-Length value must be a number.");this.nextMessageLength=r}var t=this.buffer.tryReadContent(this.nextMessageLength);if(null===t)return void this.setPartialMessageTimer();this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.messageToken++;var r=JSON.parse(t);this.callback(r)}}clearPartialMessageTimer(){this.partialMessageTimer&&(clearTimeout(this.partialMessageTimer),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),this._partialMessageTimeout<=0||(this.partialMessageTimer=setTimeout(((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())}),this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}}t.StreamMessageReader=u,t.IPCMessageReader=class extends l{constructor(e){super(),this.process=e;let t=this.process;t.on("error",(e=>this.fireError(e))),t.on("close",(()=>this.fireClose()))}listen(e){this.process.on("message",e)}},t.SocketMessageReader=class extends u{constructor(e,t="utf-8"){super(e,t)}}},7159:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(8898),o=r(311);let n="Content-Length: ",i="\r\n";(t.MessageWriter||(t.MessageWriter={})).is=function(e){let t=e;return t&&o.func(t.dispose)&&o.func(t.onClose)&&o.func(t.onError)&&o.func(t.write)};class a{constructor(){this.errorEmitter=new s.Emitter,this.closeEmitter=new s.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,r){this.errorEmitter.fire([this.asError(e),t,r])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${o.string(e.message)?e.message:"unknown"}`)}}t.AbstractMessageWriter=a,t.StreamMessageWriter=class extends a{constructor(e,t="utf8"){super(),this.writable=e,this.encoding=t,this.errorCount=0,this.writable.on("error",(e=>this.fireError(e))),this.writable.on("close",(()=>this.fireClose()))}write(e){let t=JSON.stringify(e),r=Buffer.byteLength(t,this.encoding),s=[n,r.toString(),i,i];try{this.writable.write(s.join(""),"ascii"),this.writable.write(t,this.encoding),this.errorCount=0}catch(t){this.errorCount++,this.fireError(t,e,this.errorCount)}}},t.IPCMessageWriter=class extends a{constructor(e){super(),this.process=e,this.errorCount=0,this.queue=[],this.sending=!1;let t=this.process;t.on("error",(e=>this.fireError(e))),t.on("close",(()=>this.fireClose))}write(e){this.sending||0!==this.queue.length?this.queue.push(e):this.doWriteMessage(e)}doWriteMessage(e){try{this.process.send&&(this.sending=!0,this.process.send(e,void 0,void 0,(t=>{this.sending=!1,t?(this.errorCount++,this.fireError(t,e,this.errorCount)):this.errorCount=0,this.queue.length>0&&this.doWriteMessage(this.queue.shift())})))}catch(t){this.errorCount++,this.fireError(t,e,this.errorCount)}}},t.SocketMessageWriter=class extends a{constructor(e,t="utf8"){super(),this.socket=e,this.queue=[],this.sending=!1,this.encoding=t,this.errorCount=0,this.socket.on("error",(e=>this.fireError(e))),this.socket.on("close",(()=>this.fireClose()))}dispose(){super.dispose(),this.socket.destroy()}write(e){this.sending||0!==this.queue.length?this.queue.push(e):this.doWriteMessage(e)}doWriteMessage(e){let t=JSON.stringify(e),r=Buffer.byteLength(t,this.encoding),s=[n,r.toString(),i,i];try{this.sending=!0,this.socket.write(s.join(""),"ascii",(r=>{r&&this.handleError(r,e);try{this.socket.write(t,this.encoding,(t=>{this.sending=!1,t?this.handleError(t,e):this.errorCount=0,this.queue.length>0&&this.doWriteMessage(this.queue.shift())}))}catch(r){this.handleError(r,e)}}))}catch(t){this.handleError(t,e)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}}},5043:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(311);var o;!function(e){e.ParseError=-32700,e.InvalidRequest=-32600,e.MethodNotFound=-32601,e.InvalidParams=-32602,e.InternalError=-32603,e.serverErrorStart=-32099,e.serverErrorEnd=-32e3,e.ServerNotInitialized=-32002,e.UnknownErrorCode=-32001,e.RequestCancelled=-32800,e.ContentModified=-32801,e.MessageWriteError=1,e.MessageReadError=2}(o=t.ErrorCodes||(t.ErrorCodes={}));class n extends Error{constructor(e,t,r){super(t),this.code=s.number(e)?e:o.UnknownErrorCode,this.data=r,Object.setPrototypeOf(this,n.prototype)}toJson(){return{code:this.code,message:this.message,data:this.data}}}t.ResponseError=n;class i{constructor(e,t){this._method=e,this._numberOfParams=t}get method(){return this._method}get numberOfParams(){return this._numberOfParams}}t.AbstractMessageType=i,t.RequestType0=class extends i{constructor(e){super(e,0)}},t.RequestType=class extends i{constructor(e){super(e,1)}},t.RequestType1=class extends i{constructor(e){super(e,1)}},t.RequestType2=class extends i{constructor(e){super(e,2)}},t.RequestType3=class extends i{constructor(e){super(e,3)}},t.RequestType4=class extends i{constructor(e){super(e,4)}},t.RequestType5=class extends i{constructor(e){super(e,5)}},t.RequestType6=class extends i{constructor(e){super(e,6)}},t.RequestType7=class extends i{constructor(e){super(e,7)}},t.RequestType8=class extends i{constructor(e){super(e,8)}},t.RequestType9=class extends i{constructor(e){super(e,9)}},t.NotificationType=class extends i{constructor(e){super(e,1),this._=void 0}},t.NotificationType0=class extends i{constructor(e){super(e,0)}},t.NotificationType1=class extends i{constructor(e){super(e,1)}},t.NotificationType2=class extends i{constructor(e){super(e,2)}},t.NotificationType3=class extends i{constructor(e){super(e,3)}},t.NotificationType4=class extends i{constructor(e){super(e,4)}},t.NotificationType5=class extends i{constructor(e){super(e,5)}},t.NotificationType6=class extends i{constructor(e){super(e,6)}},t.NotificationType7=class extends i{constructor(e){super(e,7)}},t.NotificationType8=class extends i{constructor(e){super(e,8)}},t.NotificationType9=class extends i{constructor(e){super(e,9)}},t.isRequestMessage=function(e){let t=e;return t&&s.string(t.method)&&(s.string(t.id)||s.number(t.id))},t.isNotificationMessage=function(e){let t=e;return t&&s.string(t.method)&&void 0===e.id},t.isResponseMessage=function(e){let t=e;return t&&(void 0!==t.result||!!t.error)&&(s.string(t.id)||s.number(t.id)||null===t.id)}},3696:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(6928),o=r(857),n=r(6982),i=r(9278),a=r(8919),c=r(7159);t.generateRandomPipeName=function(){const e=n.randomBytes(21).toString("hex");return"win32"===process.platform?`\\\\.\\pipe\\vscode-jsonrpc-${e}-sock`:s.join(o.tmpdir(),`vscode-${e}.sock`)},t.createClientPipeTransport=function(e,t="utf-8"){let r,s=new Promise(((e,t)=>{r=e}));return new Promise(((o,n)=>{let l=i.createServer((e=>{l.close(),r([new a.SocketMessageReader(e,t),new c.SocketMessageWriter(e,t)])}));l.on("error",n),l.listen(e,(()=>{l.removeListener("error",n),o({onConnected:()=>s})}))}))},t.createServerPipeTransport=function(e,t="utf-8"){const r=i.createConnection(e);return[new a.SocketMessageReader(r,t),new c.SocketMessageWriter(r,t)]}},5851:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(9278),o=r(8919),n=r(7159);t.createClientSocketTransport=function(e,t="utf-8"){let r,i=new Promise(((e,t)=>{r=e}));return new Promise(((a,c)=>{let l=s.createServer((e=>{l.close(),r([new o.SocketMessageReader(e,t),new n.SocketMessageWriter(e,t)])}));l.on("error",c),l.listen(e,"127.0.0.1",(()=>{l.removeListener("error",c),a({onConnected:()=>i})}))}))},t.createServerSocketTransport=function(e,t="utf-8"){const r=s.createConnection(e,"127.0.0.1");return[new o.SocketMessageReader(r,t),new n.SocketMessageWriter(r,t)]}},5317:e=>{e.exports=require("child_process")},6982:e=>{e.exports=require("crypto")},9896:e=>{e.exports=require("fs")},1943:e=>{e.exports=require("fs/promises")},9278:e=>{e.exports=require("net")},857:e=>{e.exports=require("os")},6928:e=>{e.exports=require("path")},9023:e=>{e.exports=require("util")}},t={};function r(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,r),n.exports}var s={};(()=>{var e=s;Object.defineProperty(e,"__esModule",{value:!0});const t=r(5747),o=r(9278),n=r(4590),i=r(5569),a=r(57),c=r(9449),l=r(5732),u=r(4565),d=r(7015),h=process.env.VSCODE_WSL_PIPE_NAME,f=parseInt(process.env.VSCODE_WSL_EXT_HOST_PID||"0",10),p=process.env.VSCODE_WSL_EXT_LOCATION,g=process.env.VSCODE_WSL_APP_ROOT,m=!!process.env.VSCODE_WSL_ENABLE_TELEMETRY,v=parseInt(process.env.VSCODE_FILE_WATCHER_POLLING||"0"),w=!!process.env.VSCODE_WSL_SCRIPTLESS_STARTUP,y=process.env.VSCODE_WSL_VERSION,S=process.env.VSCODE_WSL_DISTRO,E=!!process.env.VSCODE_WSL_DEBUG_INFO,_=process.env.VSCODE_WSL_DEFAULT_DISTRO,b=process.env.VSCODE_WSL_LOG_FILE_LOCATION,x=process.env.VSCODE_TELEMETRY_LEVEL,L=process.env.VSCODE_L10N_BUNDLE_LOCATION;let C;L&&t.config({uri:L});const T=[],N=[],R=b&&E?(0,a.createLogFile)(b,"wsl-daemon"):(0,a.nullLogFile)();async function $(e){for(let t=0;t<T.length;t++)T[t]===e&&T.splice(t,1);0===T.length&&(R.log("No more customers => exit"),C?(R.log("Result available, waiting 3 sec before exiting"),setTimeout((()=>{0===T.length?O():R.log("Exit cancelled, new customer")}),3e3)):O())}async function O(){R.log("Exiting daemon");try{const e=new Promise(((e,t)=>k.close((r=>r?t(r):e()))));await Promise.allSettled([...N.map((e=>e())),e]),R.log("Exiting daemon complete")}catch(e){R.log(`Exiting daemon problem: ${e}`)}finally{try{await R.close()}catch(e){}process.exit(0)}}process.on("uncaughtException",(e=>{R.log(`Unhandled exception: ${e}`)})),process.on("unhandledRejection",(e=>{R.log(`Unhandled rejection: ${e}`)})),function(){const e=n.createMessageConnection(new n.StreamMessageReader(process.stdin),new n.StreamMessageWriter(process.stdout));e.listen(),e.onRequest(((e,...t)=>{throw new Error("Received unexpected request")})),T.push(e);const t=setInterval((function(){try{process.kill(f,0)}catch(r){clearInterval(t),$(e)}}),1e3)}();const k=o.createServer((e=>{const t=n.createMessageConnection(new n.SocketMessageReader(e),new n.SocketMessageWriter(e));if(t.listen(),T.push(t),void 0!==C)try{t.sendNotification(i.LogNotification,[`Connecting to daemon started by other WSL window... ${C.wslVersion}`,l.LogLevel.info]),t.sendNotification(i.PortResolvedNotification,C)}catch(e){I.write(`Error sending resolved info to other WSL window: ${e}`)}e.once("close",(()=>{$(t)}))}));function W(e){e&&"EADDRINUSE"===e.code||(console.error(e),process.exit(0));const t=e=>{console.error(e),I.write(e,l.LogLevel.error)},r=o.createConnection(h,(()=>{r.removeListener("error",t);const e=n.createMessageConnection(new n.SocketMessageReader(r),new n.SocketMessageWriter(r));e.listen();const s=T[0];e.onNotification(s.sendNotification),e.onRequest(s.sendRequest),e.onUnhandledProgress((e=>s.sendProgress(new n.ProgressType,e.token,e.value))),s.onNotification(e.sendNotification),s.onRequest(e.sendRequest),s.onUnhandledProgress((t=>e.sendProgress(new n.ProgressType,t.token,t.value))),r.once("close",(()=>{process.exit(0)}))}));r.once("error",t)}function P(e,t){T.forEach((r=>{r.sendNotification(e,t)}))}k.once("error",W),k.listen(h,(async()=>{k.removeListener("error",W),async function(){const e=await(0,d.getNodeExecServer)(),t={logger:I,sendDownloadRequest:D,setDefaultDistro:q,sendProgress:e=>P(i.ProgressNotification,e),onExit:N,wslExtensionLocation:p,appRoot:g,enableTelemetry:m,fileWatcherPolling:v,wslVersion:y,distro:S,enableDebug:E,useScriptlessStartup:w,defaultDistro:_,telemetryLevel:x,productConfiguration:(0,u.getProductConfiguration)(g)};let r=await(0,c.setupRemoteServer)(t,e);"failure"===r.kind&&r.reason===l.FailureReason.NeedsLegacyServer&&(r=await(0,c.setupRemoteServer)(t,e)),"success"===r.kind?(C=r,P(i.PortResolvedNotification,r)):(P(i.FatalErrorOccuredNotification,r),O())}()}));let M=0;function D(e,t,r){const s=T[0],o=M++,n=s.onProgress(i.DownloadProgress,o,r);return s.sendRequest(i.DownloadRequest,{commit:e,platform:t,progressToken:o}).finally((()=>{n.dispose()}))}function q(e,t){return T[0].sendRequest(i.MakeDefaultRequest,{distro:e,current:t})}const I={write:(e,t=l.LogLevel.info)=>{R.log(e),P(i.LogNotification,[e,t])}};b&&I.write("WSL daemon log file: "+R.location)})();var o=exports;for(var n in s)o[n]=s[n];s.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();
//# sourceMappingURL=wslDaemon.js.map